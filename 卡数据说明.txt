用户卡：111012    123456      AAAAAAAA     0001     02030405
        有效期     密码       开那个门    识别码    四个权限
 
用户卡：110201         123456          24400000          0002     20060999
        有效期          密码           开那个门         识别码    四个权限
        2011年2月1日                   开2，7，11门               可进20，06，09，99权限的门







电梯卡 4D617374657201     02     123456    0102030499
         固定数据         没用   密码       五个权限

时间卡 4D617374657202                  090929093506     000000
          固定数据                     年月日时分秒


挂失卡 4D617374657203    123456       0003        00000000
          固定数据         密码       识别码


初始化卡  4D617374657204123456006572617365   
          固定数据 

以前的控制器加锁（第一扇区第一块）4D6173746572A3707764010000000000
以前的控制器解锁（第一扇区第一块）4D6173746572A3707764020000000000

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////



新卡格式： 用的是第一扇区0块1块2块
第0块数据为：

用户卡：111012    123456          0001     02030405    01             000000          
        有效期     密码          识别码    四个权限    01为记数开
                                                       00为记数关 

 
用户卡：110201         123456       0002      20060999                          00              000000
        有效期          密码        识别码    四个权限                          01为记数开
        2011年2月1日                          可进20，06，09，99权限的门        00为记数关


电梯卡 4D617374657201        02        123456    0102030499
         固定数据         开门时间      密码       五个权限

时间卡 4D617374657202     123456           090929093506  
          固定数据         密码            年月日时分秒


挂失卡 4D617374657203    123456       0003        00000000
          固定数据         密码       识别码

初始化卡  4D617374657204123456006572617365   
          固定数据 

解挂卡 4D617374657205    123456       0003        00000000
          固定数据         密码       识别码






第1块数据为：
要开那个门 8个字节64位，可控制64个门.         准进时段
1122334455667788 0000000000000000
8个字节64位
2440000000000000 0000000000000000
开2，7，11门

第2块数据为： 
按次数减1，4个字节,为00000000 时就是没有次数了 
开记次数首先要对卡进行初始化钱包.


读卡器发出的数据格式为：


1B 01 16 BB 12 01 02 12 34 56 00 0F 02 03 04 05 01 00 00 00 11 22 33 44 55 66 77 88 00 00 00 00 00 00 00 00 FC BA 61 80 1F F3 1B





                              1为记数开
                              0为记数关
                              f为记数没有到0
                              0为记数已到0

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
;合法卡                2短声
;非法卡                1长声
;权限不对              3短声
;有效期过/次数过       6短声
;控制器没有响应        2长声
;设置卡成功            3短声1长声
;挂失卡                1长声1短声
;控制器被锁住          1长声3短声 
*******************************************************************************************************************************

最最新卡格式： 用的是第14扇区0块1块2块,和第15扇区0块1块2块
第0块数据为：

                   /-----------------------------------------------\-------------\           在xor时为00         其它用途平时为00 
用户卡：111012    123456          0001           01                02            03             0F                    01                 070809                
        有效期     密码          识别码       x1为记数开         有效期xor     除有效期其它xor  xor                 01为测试卡#1     与UID的加密算法        
                                                      x0为记数关           \_____________\______________与_____________________/_____________________/
                                                      1x为有效期开
                                                      0x为有效期关


#1注：此功能有返回，会在14扇区第1块 写入为：CC4C9120051012051200040000000001
CC4C91         20 05 10 12 05 12    0004            000000          00              01
控制器密码     秒 分 时 日 月 年 控制器地址(当前3)                  ｜   在控制器中的错误按位计，ACC.0为 控制器与卡密码不同   
                                                                    ｜                           ACC.1为 控制器与卡地址不同     
                                                                    ｜                           ACC.2为 有效期过       
                                                                    ｜                           ACC.3为 已挂失
                                                                    ｜                           ACC.4为 控制器被锁住
                                                                    ｜                           ACC.5为 卡记数为0  
                                                                    ｜                           ACC.6现无用
                                                                    ｜                           ACC.7为 读卡器没有和控制器通讯上
                                                                    \----> ACC.0为1则测试卡没有刷控制器0为否
                                                                           ACC.1为 读卡器被锁住 



第1块数据为：
要开那个门 8个字节64位，可控制64个门.               无用
1122334455667788                           00   00000000000000
8个字节64位                                xor
2440000000000000                           00    0                 0     00                              00    00     00   00               00
开2，7，11门                               xor  JBUS  时段类型，  无用   acc.0为1启用时段              时 分 时 分   时 分 时 分          无用
                                                                         acc.1为1为周一 
                                                                         acc.2为1为周二 
                                                                         acc.3为1为周三 
                                                                         acc.4为1为周四 
                                                                         acc.5为1为周五 
                                                                         acc.6为1为周六 
                                                                         acc.7为1为周日 




第2块数据为： 
按次数减1，4个字节,为00000000 时就是没有次数了 
开记次数首先要对卡进行初始化钱包.



第15扇区0块1块2块 为地址，按位取址  第2块最后两个字节为识别码，为了方便查找。


14扇区第0块功能数据为：


                                                                                                      在卡上写前两位没用
设置卡 6D696661726501        02        123456      0102           5E                                          18          99     刷卡时要刷同步卡
         固定数据         开门时间      密码     电梯地址        这个字节                                       \         不可用
                                                           conlim5第一位为1则减次数(在卡上写5在控制器中按位)    |
                                                           conlim5第一位为0则不减次数(在卡上写5在控制器中按位)  |
                                                           conlim5第二位为1则绑定卡(在卡上写E在控制器中按位)    |
                                                           conlim5第二位为0则不绑定卡(在卡上写E在控制器中按位)  |
                                                                                                                |
                                                                                 conlim5第三位为1则启动有效期(在卡上写第三位在控制器中按位)
                                                                                 conlim5第四位acc.3=1为即设置地址又关联功能，0为只设置地址 
                                                                                 conlim5第五位和第六位0则无，1为进入，2为出去(在卡上写第三位在控制器中按位)
                                                                                 conlim5第七位
                                                                                 conlim5第八位acc.7=1为不设置地址，只设置功能


设置卡 第1块 Temp1=floorselects+jbusyns+"0"+"0"+Intotimeyn+Intotime1+Intotime2+Intotime3+Intotime4+gonggongceng;





时间卡 6D696661726502     123456           090929093506        刷卡时要刷同步卡
          固定数据         密码            年月日时分周 


挂失卡 6D696661726503    123456       0003        00000000
          固定数据         密码       识别码

新挂失卡 6D696661726503    123456       0003    0003    0000   第1块0001   0002    0003    0004    0005    0006    0007    0008  
           固定数据         密码       识别码   识别码             识别码 识别码  识别码  识别码  识别码  识别码  识别码  识别码

全部解挂  6D696661726504123456006572617365   
          固定数据 

解挂卡 6D696661726505    123456       0003        00000000
          固定数据         密码       识别码

LOCK卡 6D696661726506    123456         01          01          00000000
          固定数据         密码       固定数据     01为锁02为开

修改密码(同步卡) 6D696661726507    123456     654321     14   0000               在第1块中#BUFFER+16 依次存的是有效期年月日
                   固定数据         密码       之前密码    新密码     扇区

无密码LOCK   6D6966617265086c6f636b01     01                 000000
              固定数据                   01为锁02为开    


OPEN     6D696661726509    123456     6f70656e      01          00  刷一下开再刷一下就恢复   第一扇区为要常开的层 与用户相同。在#BUFFER+16+8中依次存的是有效期年月日
          固定数据          密码                固定数据

无密码设置密码  6D69666172650A737973707764  123456
                     固定数据                密码 



无密码清除LOCK   6D69666172650B696E69737077640100
                     固定数据     
改扇区卡         6D69666172650C736563746F72010300
                 6D69666172650C736563746F72       01                  03                00
                       固定数据             主要两个扇区首址  循环加密三个扇区首址      无用

添加卡   6D69666172650D123456616464030100
         6D69666172650D           123456       616464           03                 01        00
               固定数据            密码       固定数据    有效期2月，3年          为1年  

删除卡   6D69666172650E12345664656C000000
         6D69666172650E               123456       64656C000000
                固定数据               密码          固定数据



功能卡  6D69666172651025836966756E010300
        6D696661726510    123456           66756E        01                                                           03                                 00    
          固定数据         密码            固定数据      01为 BUS 指定卡动作 其它继电器根据卡动作                    ACC.0为1为继电器一直动作           无用
                                                         02为 BUS 刷通卡时动作，其它继电器根据卡动作 ( 同上 )        ACC.1为1为JBUS继电器一直动作
                                                         03为 BUS 指定卡动作，其它继电器两个继电器控制一层


              "6D696661726511"+userCID123+conpwd+sector+funs1+read0syn+"00";
初始化卡    6D696661726511    123456          147369            38                     0           0                     00        此卡只能刷一次，因为刷完扇区密码会变 
             固定数据          userCID       发卡器码          扇区号                  |            | acc.0为1则读0扇区
                                                                                       |              acc.1为1则全部卡号关联处理  1为是
                                                                                       |
                                                                                       |funs1=funs1|"0x1";   //是否自动选层    1为是
                                                                                        funs1=funs1|"0x2";   //继电器动作    1为是
                                                                                        funs1=funs1|"0x4";   //JBUS动作    1为是
                                                                                        funs1=funs1|"0x8";   //开放卡只控制JBUS    1为是



读卡器输出的数据
            /-----------------16字节---------------------\  /--------------------16字节-------------------\ /-----卡号---\
1B 01 26 BB 21 06 16 25 83 69 00 01 00 00 00 00 00 00 00 00 55 55 55 55 00 00 00 00 00 00 00 00 00 00 00 00 9C 44 64 80 F4 AB 1B地址不正确
1B 01 26 BB 21 06 16 25 83 69 00 02 00 00 00 00 00 00 00 00 AA AA AA AA 00 00 00 00 00 00 00 00 00 00 00 00 9C 44 64 80 F4 A8 1B地址不正确
1B 01 26 BB 21 06 16 25 83 69 00 03 00 00 00 00 00 00 00 00 FF FF FF FF 00 00 00 00 00 00 00 00 00 00 00 00 9C 44 64 80 FC A1 1B地址正确
1B 01 26 BB 21 06 16 25 83 69 00 02 00 00 00 00 00 00 00 00 AA AA AA AA 00 00 00 00 00 00 00 00 00 00 00 00 9C 44 64 80 FC A0 1B地址正确
1B 01 26 BB 21 06 16 25 83 69 00 01 00 00 00 00 00 00 00 00 55 55 55 55 00 00 00 00 00 00 00 00 00 00 00 00 9C 44 64 80 FC A3 1B地址正确

1B 01 26 BB 21 06 16 25 83 69 00 01 00 00 00 00 00 00 00 00 55 55 55 55 00 00 00 00 00 00 00 00 00 00 00 00 9C 44 64 80   FC                   A3 1B地址正确
                                                                                                                          acc.0=0,acc.1=0 计数关
                                                                                                                          acc.0=1,acc.1=1 计数不是0
                                                                                                                          acc.0=1,acc.1=0 计数是0
                                                                                                                          acc.3=1 为地址正确，0为否




语音通讯协议：1B FE 07 CC AA 01 FE 60 1B         第一个语音  

1.此卡已过期请充值.wav
2.挂失卡.wav
3.欢迎搭乘本电梯.wav
4.清空挂失卡.wav
5.时间已校正.wav
6.刷卡系统关闭.wav
7.刷卡系统启动.wav
8.同步已完成.wav
9.位置已校正.wav
a.非法卡.wav
b.位置卡
c.时间卡
d.非本电梯授权卡
e.此卡已挂失
f. 此卡即将过期请充值

对讲联动通讯协议：1B FD 07 CC C1 AA B6 AF 1B      



13扇区

 xx    xx    xx    xx    xx    xx      xx                   xx                 xx xx          xx xx xx xx xx xx 
14s0  14s1  14s2  15s0  15s1  15s2    14s0-15s2累加和  14s0-15s2异或和         UserCID            无用
累加和                                                                         循环码用



新加防复制功能说明，用的是11,12,13扇区，可以任意进8个绑定卡片的控制器，没有绑定卡的控制器随便进。
11，12，13扇区除13扇区的第2块，其它都为计数用，第2块按字节分每2个字节为一块的地址，只有这个地址可以减数。
如

0104 0204 0304 0404 0504 0604 0704 0004
11s0 11s1 11s2 12s0 12s1 12s2 13s0 13s1





记录存储格式
  XXXX    XX XX XX xx xx xx  XXXX
  编号    年 月 日 时 分 秒  次数




分用户加密方法： 1.先将给用户的发卡写入一串只有这个用户使用的密码。
                 2.再给卡片加密的时候输入这个密码，密码输入正确后所加密的卡才能用在这个用户所有控制器上。




;层数注解： 10 08 00 00  00 00 00 00  层数的字节为高4位与低4位是颠倒关系 所以 10 08 为1层和16层
1B 01 1F CC 01 50 65 CA 35 07 16 01 13 00 01 FF FF FF FF FF FF FF FF   10    05           00                00           FF 41 83 A4 A6       00 00               31 1B
                                                                     jbus   输出延时    是否为测试卡        预留         启用时段           次数记录用 
1B 01 19 CC 01 4E 38 2E 1C 02 06 15 07 19 00 06 40 00 00 00 00 00 00 00 10 00 00    64 00    AF 1B 
                                                                                    次数
1B 01 17 CC 01     CF AF FB 23          01              15 04 30     00 0A      14 73 69 39 50 10 07 05         00           03                       01              3E 1B 
                    卡号            是否启用有效期      有效期        挂失           楼层                        JBUS     输出延时               是否为测试卡
                                    acc.0  启用有效期
                                    acc.1 为启用挂失
                                    acc.2为启用楼层
                                    acc.3为只动作输出层数，之前动作的都停掉       
                                    acc.4  ;为启用准进时段        

1B 01 20 CC 01 1C 01 EE 56 84 16 16 04 21 00 04 55 55 00 00 08 00 00 00 00 05 00 00 7C 41 83 A4 B0 00 19 00 53 1B       
1B 01 20 CC 01 1C 01 EE 56 84 16 16 01 23 00 05 55 55 00 00 00 00 00 00 00 05 00 00 FF 01 01 01 01 00 19 00 08 1B      没启用有效期   启用准进时段  
1B 01 20 CC 01 1C 01 EE 56 84 16 16 01 23 00 05 55 55 00 00 00 00 00 00 00 05 00 00 FE 01 01 01 01 00 19 00 09 1B 1D 01 03 AA 01 00 A9 1D  没启用有效期   没启用准进时段  
1B 01 20 CC 01 1C 01 EE 56 84 17 16 01 23 00 05 55 55 00 00 00 00 00 00 00 05 00 00 FE 01 01 01 01 00 19 00 08 1B 1D 01 03 AA 01 01 A8 1D    启用有效期   没启用准进时段   
                                                                                        准进时段                                              

1D 01 09 AA 01 06 35 15 14 12 13 01 91 1D 


46 03 08 40 48 向发卡器发送数据    返回：4B 11 14 73 69 01 02 03 04 05 00 00 00 00 00 00 00 00 10   如果有返回说明USB 转232芯片损坏 




